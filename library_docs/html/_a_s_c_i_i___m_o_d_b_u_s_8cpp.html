<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>My Project: sketchbook/libraries/ASCII_MODBUS/ASCII_MODBUS.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_57e3097d5bf8259ea406c6ee741d086f.html">sketchbook</a></li><li class="navelem"><a class="el" href="dir_1f230a50cb8328eed74ee6db218aa7d6.html">libraries</a></li><li class="navelem"><a class="el" href="dir_108a37fc8eb94a5f76a2daf90635ecd5.html">ASCII_MODBUS</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">ASCII_MODBUS.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;avr/io.h&gt;</code><br />
<code>#include &lt;avr/interrupt.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;ctype.h&gt;</code><br />
<code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;<a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8h_source.html">ASCII_MODBUS.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_u_s_a_r_t_8h_source.html">USART.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="error_8h_source.html">error.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ASCII_MODBUS.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="_a_s_c_i_i___m_o_d_b_u_s_8cpp__incl.png" border="0" usemap="#sketchbook_2libraries_2_a_s_c_i_i___m_o_d_b_u_s_2_a_s_c_i_i___m_o_d_b_u_s_8cpp" alt=""/></div>
<map name="sketchbook_2libraries_2_a_s_c_i_i___m_o_d_b_u_s_2_a_s_c_i_i___m_o_d_b_u_s_8cpp" id="sketchbook_2libraries_2_a_s_c_i_i___m_o_d_b_u_s_2_a_s_c_i_i___m_o_d_b_u_s_8cpp">
</map>
</div>
</div>
<p><a href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a28ba3855c3afd3da796c1ad892471a9b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a28ba3855c3afd3da796c1ad892471a9b">match</a>&#160;&#160;&#160;0x00</td></tr>
<tr class="separator:a28ba3855c3afd3da796c1ad892471a9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d32b36c9a5ab4aa9acec5da4ab6469f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a4d32b36c9a5ab4aa9acec5da4ab6469f">N_REGS</a>&#160;&#160;&#160;50</td></tr>
<tr class="separator:a4d32b36c9a5ab4aa9acec5da4ab6469f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a374a05a01fa22eb4b9ab112ed08fef25"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a374a05a01fa22eb4b9ab112ed08fef25">byte_array_2_str</a> (char *line, uint8_t length, uint8_t *hex_array)</td></tr>
<tr class="memdesc:a374a05a01fa22eb4b9ab112ed08fef25"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a helper function for the pack_ASCII_str function. It converts hex digits to their equivalent ASCII characters. For example 0x1B is converted to {1 B}.  <a href="#a374a05a01fa22eb4b9ab112ed08fef25">More...</a><br /></td></tr>
<tr class="separator:a374a05a01fa22eb4b9ab112ed08fef25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65451ce4c61ddfc6a452382845b69cba"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a65451ce4c61ddfc6a452382845b69cba">LRC_gen</a> (uint8_t *data, uint8_t length)</td></tr>
<tr class="memdesc:a65451ce4c61ddfc6a452382845b69cba"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function performs the Longitudinal Redundancy Check (LRC). This is used while the MODBUS is in "ASCII mode". To quote wiki:  <a href="#a65451ce4c61ddfc6a452382845b69cba">More...</a><br /></td></tr>
<tr class="separator:a65451ce4c61ddfc6a452382845b69cba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0febfeef8581c73721cdd841a1f1428e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a0febfeef8581c73721cdd841a1f1428e">pack_ASCII_str</a> (char *line, uint8_t *c, uint8_t N_char)</td></tr>
<tr class="memdesc:a0febfeef8581c73721cdd841a1f1428e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a string formatted for a MODBUS device operating in ASCII mode. Preppend the ':' symbol, converting the bytes to ASCII Hex, and appending the LRC, CR plus LF.  <a href="#a0febfeef8581c73721cdd841a1f1428e">More...</a><br /></td></tr>
<tr class="separator:a0febfeef8581c73721cdd841a1f1428e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20886521fcd4b0b64570be1d21edbb06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a20886521fcd4b0b64570be1d21edbb06">MODBUS_init</a> (uint8_t dir_pin, uint16_t timeout)</td></tr>
<tr class="memdesc:a20886521fcd4b0b64570be1d21edbb06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the MODBUS - encapsulate the USART configuration.  <a href="#a20886521fcd4b0b64570be1d21edbb06">More...</a><br /></td></tr>
<tr class="separator:a20886521fcd4b0b64570be1d21edbb06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0e16240ce43439d7159de0380b73e6e"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#af0e16240ce43439d7159de0380b73e6e">MODBUS_put_word</a> (uint8_t slave_addr, uint16_t mem_addr, uint16_t data)</td></tr>
<tr class="memdesc:af0e16240ce43439d7159de0380b73e6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is used to write a single word to the MODBUS. An string is 15 char long plus 2 for terminating characters e.g.,.  <a href="#af0e16240ce43439d7159de0380b73e6e">More...</a><br /></td></tr>
<tr class="separator:af0e16240ce43439d7159de0380b73e6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a384044212e84f7ba3c180905b96380da"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a384044212e84f7ba3c180905b96380da">MODBUS_read_registers</a> (uint16_t *destination, uint8_t slave_addr, uint16_t starting_mem_addr, uint16_t get_n_words)</td></tr>
<tr class="memdesc:a384044212e84f7ba3c180905b96380da"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is used to read registers from MODBUS.  <a href="#a384044212e84f7ba3c180905b96380da">More...</a><br /></td></tr>
<tr class="separator:a384044212e84f7ba3c180905b96380da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab90db153d56de14d8dc9d828d3a0fd48"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#ab90db153d56de14d8dc9d828d3a0fd48">ASCII_hex_2_bin</a> (char c)</td></tr>
<tr class="memdesc:ab90db153d56de14d8dc9d828d3a0fd48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert an ASCII codex hex character into its integer equivalent.  <a href="#ab90db153d56de14d8dc9d828d3a0fd48">More...</a><br /></td></tr>
<tr class="separator:ab90db153d56de14d8dc9d828d3a0fd48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0e83f98aa4cbe98f8ab3f31a5193974"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#ae0e83f98aa4cbe98f8ab3f31a5193974">MODBUS_slave_is_new_msg</a> (void)</td></tr>
<tr class="memdesc:ae0e83f98aa4cbe98f8ab3f31a5193974"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine if a valid MODBUS message has been received. On successful retrieval the message is held in a local MODBUS_str[] buffer.  <a href="#ae0e83f98aa4cbe98f8ab3f31a5193974">More...</a><br /></td></tr>
<tr class="separator:ae0e83f98aa4cbe98f8ab3f31a5193974"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a354a11a3d03d311a9900d7236579906b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a354a11a3d03d311a9900d7236579906b">MODBUS_slave_echo</a> (void)</td></tr>
<tr class="memdesc:a354a11a3d03d311a9900d7236579906b"><td class="mdescLeft">&#160;</td><td class="mdescRight">MODBUS mode 6 is used to preset a single register. The slave replies with an echo of the original message.  <a href="#a354a11a3d03d311a9900d7236579906b">More...</a><br /></td></tr>
<tr class="separator:a354a11a3d03d311a9900d7236579906b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7151bd8f89df4c0c1f2a380575f526e7"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a7151bd8f89df4c0c1f2a380575f526e7">MODBUS_get_Nth_word</a> (uint8_t N)</td></tr>
<tr class="memdesc:a7151bd8f89df4c0c1f2a380575f526e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">The incoming MODBUS string is held in a line buffer called MODBUS_str. This function is used to pull a single word (16-bit value) from the buffer. Recall that the incoming string consists of hexadecimal encoded ASCII characters. This function combines 4 such characters.  <a href="#a7151bd8f89df4c0c1f2a380575f526e7">More...</a><br /></td></tr>
<tr class="separator:a7151bd8f89df4c0c1f2a380575f526e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87ce1e446b8ea26342b104c03e765afd"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a87ce1e446b8ea26342b104c03e765afd">MODBUS_get_Nth_int</a> (uint8_t N)</td></tr>
<tr class="memdesc:a87ce1e446b8ea26342b104c03e765afd"><td class="mdescLeft">&#160;</td><td class="mdescRight">The incoming MODBUS string is held in a line buffer called MODBUS_str. This function is used to pull a single integer (8-bit value) from the buffer. Recall that the incoming string consists of hexadecimal encoded ASCII characters. This function combines 2 such characters.  <a href="#a87ce1e446b8ea26342b104c03e765afd">More...</a><br /></td></tr>
<tr class="separator:a87ce1e446b8ea26342b104c03e765afd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a1c41e79ca742173d561ed49998ece1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a2a1c41e79ca742173d561ed49998ece1">MODBUS_put_N_words</a> (uint8_t N, uint8_t slave_addr)</td></tr>
<tr class="memdesc:a2a1c41e79ca742173d561ed49998ece1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is involved is assembling an outgoing MODBUS frame. When this function is called the values to be sent have already been collected into the buffer regs. This function prepends the slave address, MODBUS function code, and number of bytes to be sent. It them calls the pack_ASCII_str function which completes the frame assembly by prepending the ':' symbol and appending the LRC and CR/LF pair.  <a href="#a2a1c41e79ca742173d561ed49998ece1">More...</a><br /></td></tr>
<tr class="separator:a2a1c41e79ca742173d561ed49998ece1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78f7e1349673cbc6130944d506d9e1e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a78f7e1349673cbc6130944d506d9e1e9">MODBUS_buffer_words</a> (uint16_t index, uint16_t D)</td></tr>
<tr class="memdesc:a78f7e1349673cbc6130944d506d9e1e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">An outgoing MODBUS frame is built in a temporary buffer called regs. This setter function is used to place a new 16-bit value in the desired position.  <a href="#a78f7e1349673cbc6130944d506d9e1e9">More...</a><br /></td></tr>
<tr class="separator:a78f7e1349673cbc6130944d506d9e1e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a33e7e69d1abf3e9aba8eeee0c49e182d"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a33e7e69d1abf3e9aba8eeee0c49e182d">MODBUS_cmd_line</a> [<a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8h.html#af3368a8ab65cfdf99bfbd146967d63bb">size_of_cmd_lines</a>]</td></tr>
<tr class="separator:a33e7e69d1abf3e9aba8eeee0c49e182d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1e6e51e3c087c0585615a1c3b239bac"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#ae1e6e51e3c087c0585615a1c3b239bac">MODBUS_reply_line</a> [<a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8h.html#af3368a8ab65cfdf99bfbd146967d63bb">size_of_cmd_lines</a>]</td></tr>
<tr class="separator:ae1e6e51e3c087c0585615a1c3b239bac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cbc4c8baa1a6b94334e5891d0f3661b"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a9cbc4c8baa1a6b94334e5891d0f3661b">digit</a> [] = {'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'}</td></tr>
<tr class="separator:a9cbc4c8baa1a6b94334e5891d0f3661b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9df361e74b84964cd0b6c994cadc3d5b"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a9df361e74b84964cd0b6c994cadc3d5b">regs</a> [<a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a4d32b36c9a5ab4aa9acec5da4ab6469f">N_REGS</a>]</td></tr>
<tr class="separator:a9df361e74b84964cd0b6c994cadc3d5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a28ba3855c3afd3da796c1ad892471a9b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define match&#160;&#160;&#160;0x00</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a4d32b36c9a5ab4aa9acec5da4ab6469f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define N_REGS&#160;&#160;&#160;50</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00486">486</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab90db153d56de14d8dc9d828d3a0fd48"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t ASCII_hex_2_bin </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert an ASCII codex hex character into its integer equivalent. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>hex character in ASCII form</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an unsigned integer </dd></dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00366">366</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a374a05a01fa22eb4b9ab112ed08fef25"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void byte_array_2_str </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>hex_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is a helper function for the pack_ASCII_str function. It converts hex digits to their equivalent ASCII characters. For example 0x1B is converted to {1 B}. </p>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00162">162</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a65451ce4c61ddfc6a452382845b69cba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t LRC_gen </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function performs the Longitudinal Redundancy Check (LRC). This is used while the MODBUS is in "ASCII mode". To quote wiki: </p>
<p>"the 8-bit two's-complement value of the sum of all bytes modulo 2^8" </p>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00108">108</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a78f7e1349673cbc6130944d506d9e1e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MODBUS_buffer_words </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>D</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>An outgoing MODBUS frame is built in a temporary buffer called regs. This setter function is used to place a new 16-bit value in the desired position. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>specified where the data is to be placed</td></tr>
    <tr><td class="paramname">D</td><td>contains the data</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function is designed to be called from within a loop for example:</dd></dl>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;case 0x0001:</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;   for(i = 0; i &lt; n; i++){</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;       MODBUS_buffer_words(i, i + 1);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   }</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   MODBUS_put_N_words(n, MY_ADDR);</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;   break;</div>
</div><!-- fragment --> 
<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00551">551</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a87ce1e446b8ea26342b104c03e765afd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MODBUS_get_Nth_int </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>N</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The incoming MODBUS string is held in a line buffer called MODBUS_str. This function is used to pull a single integer (8-bit value) from the buffer. Recall that the incoming string consists of hexadecimal encoded ASCII characters. This function combines 2 such characters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">N</td><td>is a pointer to the starting position of the desired integer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the 8-bit value. For example, the second field in a MODBUS string is a 8-bit slave address. </dd></dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00475">475</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a7151bd8f89df4c0c1f2a380575f526e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t MODBUS_get_Nth_word </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>N</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The incoming MODBUS string is held in a line buffer called MODBUS_str. This function is used to pull a single word (16-bit value) from the buffer. Recall that the incoming string consists of hexadecimal encoded ASCII characters. This function combines 4 such characters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">N</td><td>is a pointer to the starting position of the desired word.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the 16-bit value. For example the specified data address and register data are encoded as 16-bit values. </dd></dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00447">447</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a20886521fcd4b0b64570be1d21edbb06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MODBUS_init </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dir_pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the MODBUS - encapsulate the USART configuration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dir_pin</td><td>declare the pin used to control the RS-485 transceiver</td></tr>
    <tr><td class="paramname">timeout</td><td>set the amount of time (in milliseconds) for the slave to respond.</td></tr>
  </table>
  </dd>
</dl>
<p>The USART_ISR must still be called from the main Arduino sketch. </p><pre class="fragment"> ISR(USART_RX_vect){
     USART_handle_ISR();
 }
</pre><dl class="section warning"><dt>Warning</dt><dd>The ASCII LF is used as the terminator. Don't forget the ASCII CR is part of MODBUS and will be held in the buffer. </dd></dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00086">86</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2a1c41e79ca742173d561ed49998ece1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MODBUS_put_N_words </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>slave_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is involved is assembling an outgoing MODBUS frame. When this function is called the values to be sent have already been collected into the buffer regs. This function prepends the slave address, MODBUS function code, and number of bytes to be sent. It them calls the pack_ASCII_str function which completes the frame assembly by prepending the ':' symbol and appending the LRC and CR/LF pair. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">N</td><td>number of words (16-bit) to be included in the frame</td></tr>
    <tr><td class="paramname">slave_addr</td><td>The address of the sending slave </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00503">503</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="af0e16240ce43439d7159de0380b73e6e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MODBUS_put_word </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>slave_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>mem_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is used to write a single word to the MODBUS. An string is 15 char long plus 2 for terminating characters e.g.,. </p>
<p>: 01 06 0100 1770 71 CR LF (spaces included to separate the fields)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">slave_addr</td><td>a byte identifying a particular MODBUS device. Note this must be manually programmed into a device such as the GS1.</td></tr>
    <tr><td class="paramname">mem_addr</td><td>a 16-bit value identifying the particular MODBUS register to be written</td></tr>
    <tr><td class="paramname">data</td><td>a 16-bit value containing the data to be written to mem_addr</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>result of operation, 1 = success, 0 = failure</dd></dl>
<dl class="section note"><dt>Note</dt><dd>There is a glitch as the RS-485 transceiver transitions from XMT to RCV. This delay moves the transition outside of the GS1's observation window. Note that the GS1 takes approximately 2.5 mS to start reply. </dd></dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00207">207</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a384044212e84f7ba3c180905b96380da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MODBUS_read_registers </td>
          <td>(</td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>destination</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>slave_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>starting_mem_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>get_n_words</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is used to read registers from MODBUS. </p>
<p>FIXME From the GS1 documentation page 5-72:</p>
<p>FIXME Example Message: Write a value of 60Hz to P9.26 and a value of 1 to P9.27 = 01 10 09 1b 00 02 04 02 58 00 01 5a 66 We receive a good reply = 01 10 09 1b 00 02 a3 9f</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">destination</td><td>a pointer to the location the returned values will be placed</td></tr>
    <tr><td class="paramname">slave_addr</td><td>a byte identifying a particular MODBUS device. Note this must be manually programmed into a device such as the GS1.</td></tr>
    <tr><td class="paramname">starting_mem_addr</td><td>a 16-bit value identifying the first address to be read</td></tr>
    <tr><td class="paramname">get_n_words</td><td>identify the number of words to be read from the addressed MODBUS device</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>There is a glitch as the RS-485 transceiver transitions from XMT to RCV. This delay moves the transition outside of the GS1's observation window. Note that the GS1 takes approximately 2.5 mS to start a reply. </dd></dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00280">280</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a354a11a3d03d311a9900d7236579906b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void MODBUS_slave_echo </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>MODBUS mode 6 is used to preset a single register. The slave replies with an echo of the original message. </p>
<dl class="section note"><dt>Note</dt><dd>Note the CR character is already contained in the received string since the LF was used as the terminating character.</dd>
<dd>
For debug purposes the complete MODBUS_cmd_line is available. This function could be improved by removing this feature. </dd></dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00418">418</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae0e83f98aa4cbe98f8ab3f31a5193974"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t MODBUS_slave_is_new_msg </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determine if a valid MODBUS message has been received. On successful retrieval the message is held in a local MODBUS_str[] buffer. </p>
<dl class="section return"><dt>Returns</dt><dd>0 = no new message, 1 = a valid message had been retrieved </dd></dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00389">389</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0febfeef8581c73721cdd841a1f1428e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pack_ASCII_str </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>N_char</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct a string formatted for a MODBUS device operating in ASCII mode. Preppend the ':' symbol, converting the bytes to ASCII Hex, and appending the LRC, CR plus LF. </p>
<p>An example of a properly formatted string is: { 01 10 09 1B 00 02 04 02 58 00 01 5A 66 }</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*line</td><td>is the destination</td></tr>
    <tr><td class="paramname">*c</td><td>is the source containing the character string</td></tr>
    <tr><td class="paramname">N_char</td><td>number of characters in the input string. This parameter is required as the input string may contain the NULL char.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>reference the GS1 documentation for more information. </dd></dl>

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00138">138</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a9cbc4c8baa1a6b94334e5891d0f3661b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char digit[] = {'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00063">63</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a33e7e69d1abf3e9aba8eeee0c49e182d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char MODBUS_cmd_line[<a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8h.html#af3368a8ab65cfdf99bfbd146967d63bb">size_of_cmd_lines</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00047">47</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae1e6e51e3c087c0585615a1c3b239bac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char MODBUS_reply_line[<a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8h.html#af3368a8ab65cfdf99bfbd146967d63bb">size_of_cmd_lines</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00048">48</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a9df361e74b84964cd0b6c994cadc3d5b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t regs[<a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp.html#a4d32b36c9a5ab4aa9acec5da4ab6469f">N_REGS</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html#l00488">488</a> of file <a class="el" href="_a_s_c_i_i___m_o_d_b_u_s_8cpp_source.html">ASCII_MODBUS.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Mar 2 2015 14:10:52 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
